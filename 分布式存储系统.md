### todo

- [ ] 列出上传下载速率指标，几台机器，多大文件，多块速率读写 
- [ ] minio高可用：erasure code，highway hash，reed-solomon code。n 份原始数据 + m 份备份数据，能通过 n+m 中的任意 n 份数据还原数据。todo 查论文。

### Why

* 高可用性，down 机
  * minio高可用：erasure code，highway hash，reed-solomon code。n 份原始数据 + m 份备份数据，能通过 n+m 中的任意 n 份数据还原数据。todo 查论文。

* 单机性能瓶颈
* 扩容（动态添加 group）
* 容错性（同一组，各机器互为备份）
* 允许多台计算机共享和访问文件

举例：HDFS，GFS(Google File System), Ceph

### What

文件存储、文件同步、文件下载

coor 是对等的。

同一 group 内容相同，不同 group 内容不同。

group 内剩余容量，以最小的机器为准，因此建议机器配置相同，以免浪费。

### 问题

* group 内增加机器，自动同步，同步完成后，系统自动将新增的服务器切换至线上提供服务。如何实现的
* 扩容，动态添加 group，如何实现的
* 一台机器down，如何自动切换，并提醒
* 如何处理并发访问
* 负载均衡，不同 group 剩余存储最大优先？
* 多个 coor 如何工作，挂了如何切换？
* coor、contentserver，可随时加入、退出，原理是什么？
* 上传失败，如何处理；
* 断点续传

### 遇到的印象深刻的问题并如何解决

从 issue 中找

### 考点

* 同一组内，上传完一台机器即为成功，后台线程同步至其他机器；写文件同时，写 binlog，只记录元数据，用于后台同步（？）。
* 如何处理并发访问？
  * 同一时间只有一个客户端能够修改文件：文件锁、乐观锁、分布式锁
  * coor 处理文件锁，一台 coor 会有单点故障问题，多台有同步问题？
* 如何处理网络中的丢包和超时？
  - 可以使用超时机制来检测丢包和超时情况，并根据具体情况进行重传或重新请求。此外，可以实现一些错误检测和纠正机制，如使用校验和或冗余数据等。
* 如何实现负载均衡和故障恢复？
  - 负载均衡可以通过在分布式文件系统中使用负载均衡算法，如轮询、随机选择或基于性能的选择来分发请求。故障恢复：**冗余存储**、故障转移策略。
* 数据传输协议？
  * HTTP？
* 如何确保分布式文件系统的安全性？
  * 可以采用多层次的安全措施，如身份验证、访问控制列表（ACL）、数据加密和安全传输协议（如TLS/SSL）。另外，定期进行安全审计和漏洞扫描也是保障系统安全的重要措施。
* 切片为什么是 4M？

### Key

* 不同的块可以被存储在不同的存储节点上，以实现数据的并行读写和负载均衡

### HighwayHash

利用现代计算机的 SIMD（Single Instruction, Multiple Data）架构，利用计算机硬件的并行性和数据并行性，通过同时处理多个数据块来加速哈希计算。

md5(message digest algorithm 5, 128-bit)：弱hash

SHA-256(secure hash algorithm 256-bit)：强hash

源码：利用一些与或非异或操作和移位操作，将每4字节（传入的key: a0,a1,a2,a3）与固定的4字节进行逻辑操作得到hash值。

底层使用 SIMD 指令，一次操作多个数据，加快速度。

### SIMD

Single Instruction Multi Data 一条指令处理多条数据。有点像向量（矩阵）运算。

![img](http://ftp.cvut.cz/kernel/people/geoff/cell/ps3-linux-docs/CellProgrammingTutorial/CellProgrammingTutorial.files/image008.jpg)

### 分布式知识点

#### 选主算法

如果每个节点都可以写数据，这样容易造成数据的不一致，所以需要选举一个leader，往leader节点中写数据，然后同步到follower节点中。这样就能更好的保证一致性。

##### Raft算法

##### Bully 算法

![img](https://static001.geekbang.org/resource/image/fc/b8/fc0f00a3b7c9290bc91cb4d8721dc6b8.png?wh=571*378)

##### ZAB(zookeeper atomic broadcast) 算法

#### 分布式事务

2PC（2 Phase Commit），eg. mysql 

#### 分布式锁

##### 基于数据库

##### 基于内存

### 可靠性（Reed-solomon codes）

SEC-DED(Single Error Correcting - Double Error Detect)







